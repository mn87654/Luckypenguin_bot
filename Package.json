#!/usr/bin/env bash
# render-build.sh
set -euo pipefail


echo "🔧 Using Python: $(python --version || true)"
echo "📦 Upgrading pip..."
python -m pip install --upgrade pip


echo "📚 Installing Python requirements..."
pip install -r requirements.txt


# --- Build the React WebApp (Vite) ---
if [ -d "webapp" ]; then
echo "🌐 webapp/ found. Building frontend..."


pushd webapp >/dev/null


# Prefer npm ci if lockfile exists (faster & reproducible)
if [ -f "package-lock.json" ]; then
echo "📦 Installing node deps via npm ci"
npm ci
else
echo "📦 Installing node deps via npm install (no lockfile)"
npm install
fi


echo "🏗️ Running build..."
npm run build


popd >/dev/null
echo "✅ Frontend build complete (webapp/dist)"
else
echo "⚠️ webapp/ folder not found. Skipping frontend build."
fi


echo "✅ Build phase complete."
