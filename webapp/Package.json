#!/usr/bin/env bash
# render-build.sh
set -euo pipefail


echo "ğŸ”§ Using Python: $(python --version || true)"
echo "ğŸ“¦ Upgrading pip..."
python -m pip install --upgrade pip


echo "ğŸ“š Installing Python requirements..."
pip install -r requirements.txt


# --- Build the React WebApp (Vite) ---
if [ -d "webapp" ]; then
echo "ğŸŒ webapp/ found. Building frontend..."


pushd webapp >/dev/null


# Prefer npm ci if lockfile exists (faster & reproducible)
if [ -f "package-lock.json" ]; then
echo "ğŸ“¦ Installing node deps via npm ci"
npm ci
else
echo "ğŸ“¦ Installing node deps via npm install (no lockfile)"
npm install
fi


echo "ğŸ—ï¸ Running build..."
npm run build


popd >/dev/null
echo "âœ… Frontend build complete (webapp/dist)"
else
echo "âš ï¸ webapp/ folder not found. Skipping frontend build."
fi


echo "âœ… Build phase complete."
